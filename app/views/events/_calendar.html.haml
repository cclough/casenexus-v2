- @events_by_date = current_user.events.group_by {|i| i.datetime.to_date}

- @date = params[:date] ? Date.parse(params[:date]) : Date.today


#events_calendar

  .profile_index_title
    Schedule


    #profile_index_calendar_actions.pull-right
      .btn.btn-colour.btn-round#profile_index_calendar_actions_new{ "data-container"=>"body", "data-original-title"=>"New case appointment...", rel: "tooltip", "data-placement"=>"bottom", class: "application_tooltip"}
        %i.icon-plus

      = link_to calendar_ics_url do
        .btn.btn-colour.btn-round#profile_index_calendar_actions_sync{ "data-container"=>"body", "data-original-title"=>"Sync with your calendar software/phone", rel: "tooltip", "data-placement"=>"bottom", class: "application_tooltip"}
          %i.icon-refresh
    

    %span#events_calendar_month
      = link_to date: @date.prev_month do
        %i.icon-chevron-left.icon-white
      
      %span#events_calendar_month_text
        = @date.strftime("%B %Y")

      = link_to date: @date.next_month do
        %i.icon-chevron-right.icon-white


    %span#events_calendar_month_text_count
      - month_count = current_user.events.where(created_at: (@date.beginning_of_month)..(@date.end_of_month)).count
      = "(#{pluralize(month_count,"appt")})"




  .spacer20
  


  
  #profile_index_panel_calendar_container
    = calendar @date do |date|
      .events_calendar_day_num
        = date.day
      .events_calendar_day_name
        = date.strftime('%a').upcase

      - if @events_by_date[date]

        - @events_by_date[date].each do |event|
          .events_calendar_day_event.application_tooltip{"data-id" => event.id,"data-original-title"=>"Case with " + event.partner.username + " @ " + event.datetime.strftime("%I:%M%p"), rel: "tooltip", "data-placement"=>"top",style:"left:" + (event.datetime.hour * 4).to_s + "px"}
