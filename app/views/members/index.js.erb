// Re-renders the user list
$("#map_index_users").html("<%= escape_javascript(render("users")) %>")

//Set the json as a js variable - when used getJSON in the coffeescript file it wouldn't work with e.g. different pages, just gave the same set of markers everytime
var map_index_map_markers_json = "<%= escape_javascript(User.markers(@users).to_json.html_safe) %>";

window.map_index_map_markers_draw();

// Tooltips on Avatars
$(".application_avatar_icon").tooltip()

// Marker Click Trigger - Has to be in here because other wise does not load in time for list to be loaded
$('.map_index_users_item').click(function () {

  var target_id = $(this).data('id');
  var target_lat = $(this).attr('data-lat');
  var target_lng = $(this).attr('data-lng');

  // the problem is something to do with the latlng variable i think! - overlapping with another definition
  var user_latlng = new google.maps.LatLng(target_lat,target_lng)
  window.map_index_map_pan(user_latlng)

  setTimeout((function() {
    return window.map_index_load_infobox(target_id);
  }), 300);

});

// Users Item Cascade Fade
$(".map_index_users_item").each(function (i) {

  if ((i+1) == $(".map_index_users_item").length) {
    $(this).delay((i + 1) * 50).fadeIn(function(){
      $("#map_index_users .pagination").fadeIn(500); 
    });
  } else {
    $(this).delay((i + 1) * 50).fadeIn();
  }

});

// Truncate user item names
window.application_truncatables();


$("#map_index_users .pagination a").on("click", function() {
  $.getScript(this.href);
  return false;
});




