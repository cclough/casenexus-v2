#cases_analysis_comments.panel.dark.kill_all
  .row
    .cases_analysis_block_title
      Comment Aggregator
  .row
    %ul#cases_analysis_comments_tabs.nav.nav-tabs
      %li
        %a{"data-toggle" => "tab", :href => "#cases_analysis_comments_tab_structure"} Structure
      %li
        %a{"data-toggle" => "tab", :href => "#cases_analysis_comments_tab_analytical"} Analytical
      %li
        %a{"data-toggle" => "tab", :href => "#cases_analysis_comments_tab_commercial"} Commercial
      %li
        %a{"data-toggle" => "tab", :href => "#cases_analysis_comments_tab_conclusion"} Conclusion

    .tab-content

      #cases_analysis_comments_tab_structure.cases_analysis_comments_tab.tab-pane.active
        - if Case.cases_analysis_comments_structure(current_user).count > 0
          - for comment in Case.cases_analysis_comments_structure(current_user)

            - unless (comment.analytical_comment == "")
              = link_to '/cases?id=' + comment.id.to_s do
                .cases_analysis_comment
                  .cases_analysis_comment_from
                    / line below is causing problems on heroku for no reason! - its to do with comment.marker_id
                    = User.find_by_id(comment.interviewer_id).name
                    %span.cases_analysis_comment_date
                      = comment.created_at.strftime("%d %b '%y")
                  .cases_analysis_comment_content
                    = comment.structure_comment
        - else
          No comments found
      #cases_analysis_comments_tab_analytical.cases_analysis_comments_tab.tab-pane
        - if Case.cases_analysis_comments_analytical(current_user).count > 0
          - for comment in Case.cases_analysis_comments_analytical(current_user)

            - unless (comment.analytical_comment == "")
              = link_to '/cases?id=' + comment.id.to_s do
                .cases_analysis_comment
                  .cases_analysis_comment_from
                    = User.find_by_id(comment.interviewer_id).name
                    %span.cases_analysis_comment_date
                      = comment.created_at.strftime("%d %b '%y")
                  .cases_analysis_comment_content
                    = comment.analytical_comment
        - else
          No comments found
      #cases_analysis_comments_tab_commercial.cases_analysis_comments_tab.tab-pane
        - if Case.cases_analysis_comments_commercial(current_user).count > 0
          - for comment in Case.cases_analysis_comments_commercial(current_user)

            - unless (comment.analytical_comment == "")
              = link_to '/cases?id=' + comment.id.to_s do
                .cases_analysis_comment
                  .cases_analysis_comment_from
                    = User.find_by_id(comment.interviewer_id).name
                    %span.cases_analysis_comment_date
                      = comment.created_at.strftime("%d %b '%y")
                  .cases_analysis_comment_content
                    = comment.commercial_comment
        - else
          No comments found
      #cases_analysis_comments_tab_conclusion.cases_analysis_comments_tab.tab-pane
        - if Case.cases_analysis_comments_conclusion(current_user).count > 0
          - for comment in Case.cases_analysis_comments_conclusion(current_user)

            - unless (comment.analytical_comment == "")
              = link_to '/cases?id=' + comment.id.to_s do
                .cases_analysis_comment
                  .cases_analysis_comment_from
                    = User.find_by_id(comment.interviewer_id).name
                    %span.cases_analysis_comment_date
                      = comment.created_at.strftime("%d %b '%y")
                  .cases_analysis_comment_content
                    = comment.conclusion_comment
        - else
          No comments found